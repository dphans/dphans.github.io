<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Implementing TURN server on CentOS by dphans</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/github-light.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1 class="header">Implementing TURN server on CentOS</h1>
        <p class="header"></p>
        <ul>
          <li><a class="buttons github" href="https://github.com/dphans">GitHub Profile</a></li>
        </ul>
        Posts:<br />
        <a href="Implementing-TURN-server-on-CentOS.html">1. Implementing TURN server on CentOS</a>
      </header>
      <section>
        <p><strong>TURN is an extension of STUN, so TURN server has also STUN features. When we use both STUN and TURN servers, STUN is always attempted first to speedup the connection out of getting immediate candidates when users are sitting behind same NAT. And TURN is used as fallback option depending on client locations and network topologies.</strong></p>
<h3><a id="First_Install_Prerequisite_for_CentOS_2"></a>First: Install Prerequisite for CentOS</h3>
<pre><code class="language-sh">yum install -y make gcc cc gcc-c++ wget
yum install -y openssl-devel libevent libevent-devel mysql-devel mysql-server
</code></pre>
<h3><a id="Second_Install_LibEvent_modules_9"></a>Second: Install LibEvent modules</h3>
<p>As root, build and install the library with the usual:</p>
<pre><code class="language-sh">wget https://github.com/downloads/libevent/libevent/libevent-<span class="hljs-number">2.0</span>.<span class="hljs-number">21</span>-stable.tar.gz
tar xvfz libevent-<span class="hljs-number">2.0</span>.<span class="hljs-number">21</span>-stable.tar.gz
<span class="hljs-built_in">cd</span> libevent-<span class="hljs-number">2.0</span>.<span class="hljs-number">21</span>-stable &amp;&amp; ./configure
make &amp;&amp; make install &amp;&amp; <span class="hljs-built_in">cd</span> ..
</code></pre>
<h3><a id="Third_Download__Install_TURN_modules_21"></a>Third: Download &amp; Install TURN modules</h3>
<pre><code class="language-sh">wget http://turnserver.open-sys.org/downloads/v3.<span class="hljs-number">2.4</span>.<span class="hljs-number">1</span>/turnserver-<span class="hljs-number">3.2</span>.<span class="hljs-number">4.1</span>.tar.gz
tar -xvzf turnserver-<span class="hljs-number">3.2</span>.<span class="hljs-number">4.1</span>.tar.gz
<span class="hljs-built_in">cd</span> turnserver-<span class="hljs-number">3.2</span>.<span class="hljs-number">4.1</span>
make &amp;&amp; make install
</code></pre>
<h3><a id="Fourth_Configure_turnserverconf_file_31"></a>Fourth: Configure “turnserver.conf” file</h3>
<pre><code class="language-sh"><span class="hljs-built_in">cd</span> /etc
mkdir turnserver &amp;&amp; <span class="hljs-built_in">cd</span> turnserver
vi turnserver.conf
</code></pre>
<p>Paste into your editor there lines below:</p>
<pre><code class="language-sh">user=username:password
listening-port=<span class="hljs-number">2222</span>
listening-ip=<span class="hljs-number">127.1</span>.<span class="hljs-number">1</span>
</code></pre>
<p>Press Esc and :wq to save config file.</p>
<h3><a id="Sixth_Step_Permanently_run_TURN_server_instance_49"></a>Sixth Step: “Permanently” run TURN server instance</h3>
<pre><code class="language-sh"><span class="hljs-built_in">cd</span> /etc/turnserver/
nohup turnserver -v -r ip:port <span class="hljs-operator">-a</span> -b turnuserdb.conf -c turnserver.conf -u turn-username -r ip:port -p turn-password &amp;
<span class="hljs-comment"># Replace “ip:port” with yours! E.g. 127.1.1:2222, “turn-username” with custom-username, and “turn-password” with custom-password.</span>
</code></pre>
<h4><a id="Example_57"></a>Example:</h4>
<pre><code class="language-sh">nohup turnserver -v -r <span class="hljs-number">127.1</span>.<span class="hljs-number">1</span>:<span class="hljs-number">2222</span> <span class="hljs-operator">-a</span> -b turnuserdb.conf -c turnserver.conf -u baophan -r <span class="hljs-number">127.1</span>.<span class="hljs-number">1</span>:<span class="hljs-number">2222</span> -p blablabla &amp;
</code></pre>
<p><strong>Explain: You can run TURN server “forever”, need placed turnserver command between “nohup” and “&amp;”, like this:</strong></p>
<pre><code class="language-sh">nohup TURN-execution-command &amp;
</code></pre>
<p><strong>In javascript (Embedding a visible password in your Javascript code may allow someone else to use your TURN server):</strong></p>
<pre><code class="language-javascript"><span class="hljs-keyword">var</span> pc_config = {<span class="hljs-string">"iceServers"</span>: [{<span class="hljs-string">"url"</span>: <span class="hljs-string">"stun:stun.l.google.com:19302"</span>},{<span class="hljs-string">"url"</span>:<span class="hljs-string">"turn:my_username@&lt;turn_server_ip_address&gt;"</span>, <span class="hljs-string">"credential"</span>:<span class="hljs-string">"my_password"</span>}]};
</code></pre>
<p><strong>Example on Android:</strong></p>
<pre><code class="language-java">iceServers.add(<span class="hljs-keyword">new</span> PeerConnection.IceServer(<span class="hljs-string">"turn:turn_server_ip_address"</span>, <span class="hljs-string">"myusername"</span>, <span class="hljs-string">"my password"</span>));
</code></pre>
      </section>
      <footer>
        <p><small>Hosted on <a href="https://pages.github.com">GitHub Pages</a> using the Dinky theme</small></p>
      </footer>
    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
		
  </body>
</html>
